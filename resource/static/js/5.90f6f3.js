(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{366:function(t,e,a){},367:function(t,e,a){"use strict";var i=a(366);a.n(i).a},368:function(t,e,a){"use strict";var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{staticClass:"ui-bread-crumb"},[i("Breadcrumb",a._l(a.data,function(t,e){return i("BreadcrumbItem",{key:e},[a._v(a._s(t))])}),1)],1)};i._withStripped=!0;var s={props:{data:{type:Array,default:function(){return[]}}}},r=(a(367),a(47)),n=Object(r.a)(s,i,[],!1,null,null,null);n.options.__file="src/components/manage/common/bread-crumb.vue";e.a=n.exports},369:function(t,e,a){"use strict";var i=a(18),n=a.n(i),s=a(108),r=a.n(s);e.a={data:function(){return{TABLE_CONFIG:{field:{id:"id"},api:{query:"",delete:""}},filter:{pageNum:1,pageSize:15,sort:""},autoLoad:!0,loading:!0,listData:[],totalCount:0,pickedId:[],usePage:!0,useRouterQuery:!1}},beforeRouteUpdate:function(t,e,a){if(this.useRouterQuery){var i=t.query.page||1;this.filter.pageNum=parseInt(i),this.fetchData(),a()}else a()},methods:{fetchData:function(t,e){var a=this;this.TABLE_CONFIG.api.query&&(!t&&this.loading||(this.beforeFetch&&this.beforeFetch(),e=n()({},this.filter,e),this.loading=!0,this.$api(this.TABLE_CONFIG.api.query,e,{showLoading:!0}).then(function(t){a.loading=!1,a.filter=e,a.parseData(t.result),a.afterFetch&&a.afterFetch()}).catch(function(t){a.loading=!1,a._showErrMsg(t)})))},parseData:function(t){this.usePage?(this.listData=t.records,this.totalCount=t.total):(this.listData=t,this.totalCount=t.length)},deleteData:function(t,e){if(this.TABLE_CONFIG.api.delete){var a=this,i=[],s="确定删除该条数据么?";if(t?i.push(t):(i=a.pickedId,s="确定删除选中的数据么?"),!i.length)return a.$Message.warning("未选择任何数据"),!1;var r=n()({},e);r[a.TABLE_CONFIG.field.id]=i.join(","),a._asyncDialog(s,r)}},_asyncDialog:function(t,e){var a=this;a.$Modal.confirm({title:"警告",content:"<p>".concat(t,"</p>"),loading:!0,onOk:function(){a.$api(a.TABLE_CONFIG.api.delete,e).then(function(t){a.$Modal.remove(),a.$Message.success("删除成功"),a.usePage?a.fetchData():a.__delListData(ids)}).catch(function(t){setTimeout(function(){a.$Modal.remove()},500),a._showErrMsg(t)})}})},__delListData:function(a){var i=this;this.listData.forEach(function(t,e){~a.indexOf(t[i.TABLE_CONFIG.field.id])&&i.listData.splice(e,1)})},selectRow:function(t){var e=this,a=[];t.forEach(function(t){a.push(t[e.TABLE_CONFIG.field.id])}),this.pickedId=a},sortData:function(t){t.order?this.filter.sort="ascending"==t.order?2:1:this.filter.sort="",this.fetchData()},pageChange:function(t){if(this.beforePageChange&&this.beforePageChange(t),this.useRouterQuery){var e=this.$route;if((e.query.page||1)==this.filter.pageNum)return;var a={name:e.name,meta:n()({},e.meta),params:n()({},e.params),query:n()({},e.query)};a.query.page=t,e.name||(a.path=e.path),this.$router.push(a)}else this.fetchData();this.afterPageChange&&this.afterPageChange(t)},pushData:function(t){this.listData.unshift(t),this.listData.splice(this.filter.pageSize),this.totalCount++},updateData:function(i){var s=this,r=-1;this.listData.forEach(function(t,e){var a=t[s.TABLE_CONFIG.field.id];a&&a==i[s.TABLE_CONFIG.field.id]&&(r=e)}),-1!=r&&this.$set(this.listData,r,i)}},created:function(){this.fetchDataHandle=r()(this.fetchData,200);var t=this.$route.query.page;t&&(this.filter.pageNum=parseInt(t)),this.autoLoad&&this.fetchData(!0)}}},370:function(t,e,a){"use strict";var i=a(18),s=a.n(i);e.a={data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{info:"",add:"",edit:""}},id:0,inited:!1,formData:{},rules:{},dialogShow:!1,loading:!1,hasEdited:!1,saving:!1,labelWidth:"7em",unEdit:!1}},computed:{title:function(){return this.id?"编辑":"添加"}},watch:{formData:{handler:function(){this.inited&&(this.hasEdited=!0)},deep:!0}},methods:{show:function(t,e,a){this.id=t||0,this.unEdit=a||!1,this.dialogShow=!0,e?this.setFormData(e):this.id?this.fetchData():this.setFormData(this._defaultFormData)},close:function(t){this.hasEdited,this.closeHandle(),"function"==typeof t&&t()},closeHandle:function(){this.dialogShow=!1,this.resetTimer=setTimeout(this.reset,300)},fetchData:function(){var e=this;if(this.FORM_CONFIG.api.info&&!this.loading){var t={};t[this.FORM_CONFIG.field.id]=this.id,this.loading=!0,this.$api(this.FORM_CONFIG.api.info,t).then(function(t){e.setFormData(t.result),e.loading=!1}).catch(function(t){e.loading=!1,e._showErrMsg(t)})}},setFormData:function(t){var e=this;this.formData=s()(!0,{},t),this.$refs.form.resetFields(),this.onSetFormData&&this.onSetFormData(),this.$nextTick(function(){e.inited=!0})},save:function(){var e=this;this.saving||this.$refs.form.validate(function(t){t&&e.post()})},post:function(){var e=this,a=this.id?"edit":"add",t=this.FORM_CONFIG.api[a];if(t&&(!this.beforeSave||!1!==this.beforeSave())){this.saving=!0;var i=this.parsePostData?this.parsePostData():this.formData;this.$api(t,i).then(function(t){e.$emit(a,t.result),e.saving=!1,e.hasEdited=!1,e.$Message.success("保存成功"),e.close(),e.onSuccess&&e.onSuccess(t)}).catch(function(t){e._showErrMsg(t),e.saving=!1,e.onFail&&e.onFail(t)})}},reset:function(){clearTimeout(this.resetTimer),this.inited=!1,this.hasEdited=!1;var t=this.$refs.form;t&&t.resetFields()}},created:function(){this._defaultFormData=s()(!0,{},this.formData)}}},390:function(t,e,a){},391:function(t,e,a){},392:function(t,e,a){},393:function(t,e,a){},418:function(t,e,a){"use strict";var i=a(390);a.n(i).a},419:function(t,e,a){"use strict";var i=a(391);a.n(i).a},420:function(t,e,a){"use strict";var i=a(392);a.n(i).a},421:function(t,e,a){"use strict";var i=a(393);a.n(i).a},431:function(t,e,a){"use strict";a.r(e);var i=function(){var i=this,t=i.$createElement,s=i._self._c||t;return s("div",{directives:[{name:"title",rawName:"v-title",value:i.pageTitle,expression:"pageTitle"}],staticClass:"c-m-system-firstMerchant ui-box"},[s("bread-crumb",{attrs:{data:i.crumbData}}),i._v(" "),s("search",{staticClass:"ui-search",attrs:{data:i.filter},on:{search:i.fetchData}}),i._v(" "),s("div",{staticClass:"ui-hander"},[i._auth("merchant-manage-first-add")?s("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:i.showAdd}},[i._v("新增")]):i._e()],1),i._v(" "),s("div",{staticClass:"ui-table-content"},[s("Table",{attrs:{border:"",columns:i.columns,data:i.listData},on:{"on-selection-change":i.selectRow},scopedSlots:i._u([{key:"status",fn:function(t){var e=t.row;t.column,t.index;return[s("span",{class:i._f("startupStatusColor")(e.startupStatus)},[i._v(i._s(i._f("startupStatus")(e.startupStatus)))])]}},{key:"handlestatus",fn:function(t){var e=t.row,a=(t.column,t.index);return[s("i-switch",{staticClass:"ui-switch",attrs:{disabled:!i._auth("merchant-manage-first-setStatus"),loading:e.switchLoading,"false-value":"0","true-value":"1",size:"large"},on:{"on-change":function(t){return i.changeStatusConfirm(e,a)}},model:{value:e.startupStatus,callback:function(t){i.$set(e,"startupStatus",t)},expression:"row.startupStatus"}},[s("span",{attrs:{slot:"open"},slot:"open"},[i._v("启用")]),i._v(" "),s("span",{attrs:{slot:"close"},slot:"close"},[i._v("停用")])])]}},{key:"handle",fn:function(t){var e=t.row;t.column,t.index;return[i._auth("merchant-manage-first-detail")?s("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return i.showDetail(e.merchantId,e,!0)}}},[i._v("详情")]):i._e(),i._v(" "),i._auth("merchant-manage-first-edit")?s("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return i.showEdit(e.merchantId,e)}}},[i._v("编辑")]):i._e(),i._v(" "),i._auth("merchant-manage-first-del")?s("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return i.deleteData(e.merchantId)}}},[i._v("删除")]):i._e()]}}])})],1),i._v(" "),s("div",{staticClass:"ui-page"},[s("Page",{attrs:{placement:"top",total:i.totalCount,current:i.filter.pageNum,"page-size":i.filter.pageSize,"show-elevator":"","show-total":""},on:{"on-change":i.pageChange,"update:current":function(t){return i.$set(i.filter,"pageNum",t)}}})],1),i._v(" "),s("dialog-form",{ref:"form",on:{edit:i.fetchData,add:i.fetchData}})],1)};i._withStripped=!0;var s=a(368),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ui-first-merchant-search search-bar"},[a("Form",{attrs:{model:e.data,inline:"","label-width":90}},[a("FormItem",{attrs:{prop:"merchantId",label:"商户代码"}},[a("Input",{attrs:{placeholder:"商户代码"},model:{value:e.data.merchantId,callback:function(t){e.$set(e.data,"merchantId",t)},expression:"data.merchantId"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"merchantName",label:"商户名称"}},[a("Input",{attrs:{placeholder:"商户名称"},model:{value:e.data.merchantName,callback:function(t){e.$set(e.data,"merchantName",t)},expression:"data.merchantName"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"startupStatus",label:"启用状态"}},[a("Select",{attrs:{placeholder:"启用状态"},model:{value:e.data.startupStatus,callback:function(t){e.$set(e.data,"startupStatus",t)},expression:"data.startupStatus"}},e._l(e.startupStatusOptions,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("br"),e._v(" "),a("FormItem",[a("Button",{attrs:{icon:"ios-search"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{attrs:{icon:"md-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1)};r._withStripped=!0;var n={props:{data:{type:Object,default:function(){return{}}}},data:function(){return{startupStatusOptions:[{label:"未启用",value:0},{label:"启用",value:1}]}},methods:{search:function(){this.$emit("search")},reset:function(){this.data.merchantId="",this.data.merchantName="",this.data.startupStatus="",this.search()}}},o=(a(418),a(47)),l=Object(o.a)(n,r,[],!1,null,null,null);l.options.__file="src/components/manage/merchant/first/search.vue";var c=l.exports,u=a(369),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-merchant-first-dialog"},[a("Modal",{staticClass:"ui-form merchant-first-form",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.close},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("Form",{ref:"form",staticClass:"ui-tabel-body c",attrs:{rules:e.rules,model:e.formData,"label-width":100}},[a("FormItem",{attrs:{label:"一级商户编码",prop:"merchantId"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"一级商户编码"},model:{value:e.formData.merchantId,callback:function(t){e.$set(e.formData,"merchantId",t)},expression:"formData.merchantId"}})],1),e._v(" "),a("FormItem",{attrs:{label:"商户名称",prop:"merchantName"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"商户名称"},model:{value:e.formData.merchantName,callback:function(t){e.$set(e.formData,"merchantName",t)},expression:"formData.merchantName"}})],1),e._v(" "),a("FormItem",{staticClass:"upload-certFile",attrs:{label:"商户证书",prop:"merchantCertFile"}},[a("Input",{attrs:{disabled:e.unEdit,readonly:"",placeholder:"请上传商户证书"},model:{value:e.formData.merchantCertFile,callback:function(t){e.$set(e.formData,"merchantCertFile",t)},expression:"formData.merchantCertFile"}}),e._v(" "),a("Button",{attrs:{icon:"ios-cloud-upload-outline",type:"primary",disabled:e.unEdit},on:{click:e.upload}},[e._v(e._s(e.textFormatter))])],1),e._v(" "),a("FormItem",{attrs:{label:"证书密码",prop:"merchantCertPassword"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"证书密码"},model:{value:e.formData.merchantCertPassword,callback:function(t){e.$set(e.formData,"merchantCertPassword",t)},expression:"formData.merchantCertPassword"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.loading||e.saving||e.unEdit,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1),e._v(" "),a("upload-model",{ref:"uploadmodel",attrs:{url:e.urlPath,option:e.uploadOption},on:{done:e.done}})],1)],1)},d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{staticClass:"ui-upload-model ui-form",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.hide},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("Upload",{ref:"upload",attrs:{multiple:e.options.multiple,type:"drag",data:{jsessionid:e.jsessionid},format:e.options.format,"max-size":e.options.maxSize,"before-upload":e.handleBeforeUpload,"on-exceeded-size":e.handleMaxSize,"on-format-error":e.handleFormatError,"on-error":e.handleError,"on-progress":e.handleProgress,"on-success":e.handleSuccess,action:e.url,name:e.options.name}},[a("div",{staticStyle:{padding:"60px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e._v(" "),a("p",[e._v("点击或将文件拖拽到这里进行上传")]),e._v(" "),a("p",{staticStyle:{color:"#999"}},[e._v("("+e._s(e.options.tip)+")")])],1)]),e._v(" "),e.chooseFile?a("p",[e._v("已选择文件："),a("span",{staticClass:"choosed"},[e._v(e._s(e.chooseFile))])]):e._e(),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.hide}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",loading:e.loadingStatus},on:{click:e.uploadFile}},[e._v("上传")])],1)],1)],1)};d._withStripped=h._withStripped=!0;var f=a(18),m=a.n(f),p=a(33),g=a(54),v={multiple:!1,maxSize:10240,format:[],name:"file",urlPath:"",tip:"请上传文件,大小不超过10M"},_={props:{option:{type:Object,default:function(){return{}}},url:{type:String,default:""}},data:function(){return{jsessionid:this.$store.state.info.UserToken,loadingStatus:!1,title:"文件上传",visible:!1,options:{},readyFiles:[]}},computed:{chooseFile:function(){return this.readyFiles.map(function(t){return t.name}).join(",")}},methods:{show:function(){this.visible=!0,this.options=m()({},v,this.option)},hide:function(){this.visible=!1,this.reset()},handleBeforeUpload:function(t){return this.readyFiles.push(t),!1},handleFormatError:function(t,e){var a="文件 ".concat(t.name," 的格式错误");this.$Message.error(a),this.reset()},handleMaxSize:function(t,e){var a=Object(g.a)(1024*this.options.maxSize," "),i="文件 ".concat(t.name," 大小超过").concat(a);this.$Message.error(i),this.reset()},handleError:function(t,e,a){this._showErrMsg(t,"上传失败"),this.loadingStatus=!1},handleProgress:function(t,e,a){},handleSuccess:function(t,e,a){0==t.success?168==t.code?this._loseSession():(this.$Message.error(t.message||"上传失败"),this.reset()):(this.$emit("done",t.result),this.hide(),this.$Message.success("上传成功"))},uploadFile:function(){this.readyFiles;if(this.readyFiles.length){this.loadingStatus=!0;for(var t=0;t<this.readyFiles.length;t++){var e=this.readyFiles[t];this.$refs.upload.post(e)}}else this.$Message.warning("请选择文件")},reset:function(){this.loadingStatus=!1,this.readyFiles=[],this.$refs.upload.clearFiles()}}},F=(a(419),Object(o.a)(_,d,[],!1,null,null,null));F.options.__file="src/components/manage/common/upload-model.vue";var b=F.exports,D=a(370),w=/^[0-9a-zA-Z]*$/,S={mixins:[D.a],components:{UploadModel:b},data:function(){return{uploadOption:{maxSize:2048,format:["pfx"],name:"cerFile",tip:"请上传pfx文件,大小不超过2M"},FORM_CONFIG:{field:{id:"merchantId"},api:{add:this.$cfg.API.merchant.first.add,edit:this.$cfg.API.merchant.first.edit}},formData:{merchantId:"",merchantName:"",merchantCertFile:"",merchantCertPassword:""},rules:{merchantId:[{required:!0,message:"请填写一级商户代码",trigger:"blur"},{validator:this.checkNum,trigger:"blur"}],merchantName:[{required:!0,message:"请填写商户名称",trigger:"blur"}],merchantCertFile:[{required:!0,message:"请上传证书",trigger:"change"}],merchantCertPassword:[{required:!0,message:"请填写商户私钥加密密码",trigger:"blur"}]}}},computed:{urlPath:function(){return p.c.completion(this.$cfg.API.merchant.first.uploadCerFil)},textFormatter:function(){return this.id?"重新上传":"上传证书"}},methods:{checkNum:function(t,e,a){if(!w.test(e))return a(new Error("请输入数字或字母"));a()},upload:function(){this.$refs.uploadmodel.show()},done:function(t){this.formData.merchantCertFile=t.merchantCertFile}}},C=(a(420),Object(o.a)(S,h,[],!1,null,null,null));C.options.__file="src/components/manage/merchant/first/form.vue";var I=C.exports,$={mixins:[u.a],components:{BreadCrumb:s.a,Search:c,DialogForm:I},data:function(){return{pageTitle:"一级商户管理",crumbData:["商户管理","一级商户管理"],filter:{merchantId:"",merchantName:"",startupStatus:""},TABLE_CONFIG:{field:{id:"merchantId"},api:{query:this.$cfg.API.merchant.first.query,delete:this.$cfg.API.merchant.first.del}},columns:[{title:"序号",type:"index",width:50,align:"center"},{title:"一级商户编码",key:"merchantId",align:"center"},{title:"商户名称",key:"merchantName",align:"center"},{title:"商户证书",key:"merchantCertFile",align:"center"},{title:"证书密码",key:"merchantCertPassword",align:"center"},{title:"启用状态",align:"center",slot:"status"},{title:"修改启用状态",align:"center",width:120,slot:"handlestatus"},{title:"操作",align:"center",width:200,slot:"handle"}]}},filters:{startupStatus:function(t){return 1==t?"已启用":0==t?"已停用":void 0},startupStatusColor:function(t){return 1==t?"success":0==t?"gray":void 0}},methods:{showAdd:function(){this.$refs.form.show()},showEdit:function(t,e){this.$refs.form.show(t,e)},showDetail:function(t,e,a){this.$refs.form.show(t,e,a)},changeStatusConfirm:function(t,e){var a=this;a.$set(a.listData[e],"switchLoading",!0),a.$Modal.confirm({title:"警告",content:"<p>确定更改启用状态吗?</p>",loading:!0,onOk:function(){a.changeStatus(t,e),a.$Modal.remove()},onCancel:function(){a.$set(a.listData[e],"switchLoading",!1)}})},changeStatus:function(t,e){var a=this,i=t.merchantId,s=t.startupStatus;a.$api(a.$cfg.API.merchant.first.updateStatus,{merchantId:i,startupStatus:s}).then(function(t){a.$set(a.listData[e],"startupStatus",s),a.$set(a.listData[e],"switchLoading",!1),a.$Message.success("状态修改成功")}).catch(function(t){a.$set(a.listData[e],"startupStatus","1"==s?"0":"1"),a.$set(a.listData[e],"switchLoading",!1),a._showErrMsg(t,"状态修改失败")})}}},y=(a(421),Object(o.a)($,i,[],!1,null,null,null));y.options.__file="src/components/manage/merchant/first/index.vue";e.default=y.exports}}]);