(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{366:function(t,e,a){},367:function(t,e,a){"use strict";var i=a(366);a.n(i).a},368:function(t,e,a){"use strict";var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{staticClass:"ui-bread-crumb"},[i("Breadcrumb",a._l(a.data,function(t,e){return i("BreadcrumbItem",{key:e},[a._v(a._s(t))])}),1)],1)};i._withStripped=!0;var s={props:{data:{type:Array,default:function(){return[]}}}},o=(a(367),a(47)),n=Object(o.a)(s,i,[],!1,null,null,null);n.options.__file="src/components/manage/common/bread-crumb.vue";e.a=n.exports},369:function(t,e,a){"use strict";var i=a(18),n=a.n(i),s=a(108),o=a.n(s);e.a={data:function(){return{TABLE_CONFIG:{field:{id:"id"},api:{query:"",delete:""}},filter:{pageNum:1,pageSize:15,sort:""},autoLoad:!0,loading:!0,listData:[],totalCount:0,pickedId:[],usePage:!0,useRouterQuery:!1}},beforeRouteUpdate:function(t,e,a){if(this.useRouterQuery){var i=t.query.page||1;this.filter.pageNum=parseInt(i),this.fetchData(),a()}else a()},methods:{fetchData:function(t,e){var a=this;this.TABLE_CONFIG.api.query&&(!t&&this.loading||(this.beforeFetch&&this.beforeFetch(),e=n()({},this.filter,e),this.loading=!0,this.$api(this.TABLE_CONFIG.api.query,e,{showLoading:!0}).then(function(t){a.loading=!1,a.filter=e,a.parseData(t.result),a.afterFetch&&a.afterFetch()}).catch(function(t){a.loading=!1,a._showErrMsg(t)})))},parseData:function(t){this.usePage?(this.listData=t.records,this.totalCount=t.total):(this.listData=t,this.totalCount=t.length)},deleteData:function(t,e){if(this.TABLE_CONFIG.api.delete){var a=this,i=[],s="确定删除该条数据么?";if(t?i.push(t):(i=a.pickedId,s="确定删除选中的数据么?"),!i.length)return a.$Message.warning("未选择任何数据"),!1;var o=n()({},e);o[a.TABLE_CONFIG.field.id]=i.join(","),a._asyncDialog(s,o)}},_asyncDialog:function(t,e){var a=this;a.$Modal.confirm({title:"警告",content:"<p>".concat(t,"</p>"),loading:!0,onOk:function(){a.$api(a.TABLE_CONFIG.api.delete,e).then(function(t){a.$Modal.remove(),a.$Message.success("删除成功"),a.usePage?a.fetchData():a.__delListData(ids)}).catch(function(t){setTimeout(function(){a.$Modal.remove()},500),a._showErrMsg(t)})}})},__delListData:function(a){var i=this;this.listData.forEach(function(t,e){~a.indexOf(t[i.TABLE_CONFIG.field.id])&&i.listData.splice(e,1)})},selectRow:function(t){var e=this,a=[];t.forEach(function(t){a.push(t[e.TABLE_CONFIG.field.id])}),this.pickedId=a},sortData:function(t){t.order?this.filter.sort="ascending"==t.order?2:1:this.filter.sort="",this.fetchData()},pageChange:function(t){if(this.beforePageChange&&this.beforePageChange(t),this.useRouterQuery){var e=this.$route;if((e.query.page||1)==this.filter.pageNum)return;var a={name:e.name,meta:n()({},e.meta),params:n()({},e.params),query:n()({},e.query)};a.query.page=t,e.name||(a.path=e.path),this.$router.push(a)}else this.fetchData();this.afterPageChange&&this.afterPageChange(t)},pushData:function(t){this.listData.unshift(t),this.listData.splice(this.filter.pageSize),this.totalCount++},updateData:function(i){var s=this,o=-1;this.listData.forEach(function(t,e){var a=t[s.TABLE_CONFIG.field.id];a&&a==i[s.TABLE_CONFIG.field.id]&&(o=e)}),-1!=o&&this.$set(this.listData,o,i)}},created:function(){this.fetchDataHandle=o()(this.fetchData,200);var t=this.$route.query.page;t&&(this.filter.pageNum=parseInt(t)),this.autoLoad&&this.fetchData(!0)}}},370:function(t,e,a){"use strict";var i=a(18),s=a.n(i);e.a={data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{info:"",add:"",edit:""}},id:0,inited:!1,formData:{},rules:{},dialogShow:!1,loading:!1,hasEdited:!1,saving:!1,labelWidth:"7em",unEdit:!1}},computed:{title:function(){return this.id?"编辑":"添加"}},watch:{formData:{handler:function(){this.inited&&(this.hasEdited=!0)},deep:!0}},methods:{show:function(t,e,a){this.id=t||0,this.unEdit=a||!1,this.dialogShow=!0,e?this.setFormData(e):this.id?this.fetchData():this.setFormData(this._defaultFormData)},close:function(t){this.hasEdited,this.closeHandle(),"function"==typeof t&&t()},closeHandle:function(){this.dialogShow=!1,this.resetTimer=setTimeout(this.reset,300)},fetchData:function(){var e=this;if(this.FORM_CONFIG.api.info&&!this.loading){var t={};t[this.FORM_CONFIG.field.id]=this.id,this.loading=!0,this.$api(this.FORM_CONFIG.api.info,t).then(function(t){e.setFormData(t.result),e.loading=!1}).catch(function(t){e.loading=!1,e._showErrMsg(t)})}},setFormData:function(t){var e=this;this.formData=s()(!0,{},t),this.$refs.form.resetFields(),this.onSetFormData&&this.onSetFormData(),this.$nextTick(function(){e.inited=!0})},save:function(){var e=this;this.saving||this.$refs.form.validate(function(t){t&&e.post()})},post:function(){var e=this,a=this.id?"edit":"add",t=this.FORM_CONFIG.api[a];if(t&&(!this.beforeSave||!1!==this.beforeSave())){this.saving=!0;var i=this.parsePostData?this.parsePostData():this.formData;this.$api(t,i).then(function(t){e.$emit(a,t.result),e.saving=!1,e.hasEdited=!1,e.$Message.success("保存成功"),e.close(),e.onSuccess&&e.onSuccess(t)}).catch(function(t){e._showErrMsg(t),e.saving=!1,e.onFail&&e.onFail(t)})}},reset:function(){clearTimeout(this.resetTimer),this.inited=!1,this.hasEdited=!1;var t=this.$refs.form;t&&t.resetFields()}},created:function(){this._defaultFormData=s()(!0,{},this.formData)}}},386:function(t,e,a){},414:function(t,e,a){"use strict";var i=a(386);a.n(i).a},433:function(t,e,a){"use strict";a.r(e);var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{directives:[{name:"title",rawName:"v-title",value:a.pageTitle,expression:"pageTitle"}],staticClass:"c-m-system-role"},[i("bread-crumb",{attrs:{data:a.crumbData}}),a._v(" "),i("div",{staticClass:"ui-hander",staticStyle:{"padding-top":"65px"}},[a._auth("system-setting-role-add")?i("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:a.showAdd}},[a._v("新增")]):a._e()],1),a._v(" "),i("div",{staticClass:"ui-table-content"},[i("Table",{attrs:{border:"",columns:a.columns,data:a.listData},scopedSlots:a._u([{key:"handle",fn:function(t){var e=t.row;t.column,t.index;return[a._auth("system-setting-role-detail")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showDetail(e.id,e,!0)}}},[a._v("详情")]):a._e(),a._v(" "),a._auth("system-setting-role-edit")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showEdit(e.id,e)}}},[a._v("编辑")]):a._e(),a._v(" "),a._auth("system-setting-role-del")?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return a.deleteData(e.id)}}},[a._v("删除")]):a._e(),a._v(" "),a._auth("system-setting-role-setAuth")?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return a.showAuth(e.id)}}},[a._v("权限设置")]):a._e()]}}])})],1),a._v(" "),i("div",{staticClass:"ui-page"},[i("Page",{attrs:{placement:"top",current:a.filter.pageNum,total:a.totalCount,"page-size":a.filter.pageSize,"show-elevator":"","show-total":""},on:{"on-change":a.pageChange,"update:current":function(t){return a.$set(a.filter,"pageNum",t)}}})],1),a._v(" "),i("dialog-form",{ref:"dialogform",on:{edit:a.fetchData,add:a.fetchData}}),a._v(" "),i("auth-form",{ref:"authform"})],1)};i._withStripped=!0;var s=a(368),o=a(369),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-system-role-dialog"},[a("Modal",{staticClass:"ui-form",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.close},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("Form",{ref:"form",staticClass:"ui-tabel-body c",attrs:{rules:e.rules,model:e.formData,"label-width":90}},[a("FormItem",{attrs:{label:"角色名称",prop:"name"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"角色名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"备注",prop:"remark"}},[a("Input",{attrs:{disabled:e.unEdit,type:"textarea",placeholder:"备注"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.loading||e.saving||e.unEdit,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1)],1)],1)};n._withStripped=!0;var r={mixins:[a(370).a],data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{add:this.$cfg.API.system.role.add,edit:this.$cfg.API.system.role.edit}},formData:{name:"",remark:""},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}}}},l=a(47),c=Object(l.a)(r,n,[],!1,null,null,null);c.options.__file="src/components/manage/system/role/form.vue";var u=c.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-system-roleauth"},[a("Modal",{staticClass:"ui-form",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.close},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("Tstree",{ref:"trees",attrs:{data:e.authTreeList}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("保存")])],1)],1)],1)};h._withStripped=!0;var d=a(152),f=a.n(d),m=a(365),p={components:{Tstree:a.n(m).a},data:function(){return{title:"权限设置",dialogShow:!1,loading:!1,roleId:"",authTreeList:[]}},methods:{show:function(t){this.roleId=t||null,this.fetchAuth()},close:function(){var t=this;t.dialogShow=!1,setTimeout(function(){t.authTreeList=[]},500)},fetchAuth:function(){var e=this;this.$api(this.$cfg.API.system.role.getAllRole,{roleId:this.roleId},{showLoading:!0}).then(function(t){t.result.treesData&&t.result.treesData.length&&e.getAuth(t.result.treesData,!0),e.dialogShow=!0,e.authTreeList=t.result.treesData}).catch(function(){})},getAuth:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0,a=this;return t.forEach(function(t){t.title=t.name,t.checkbox=!0,e&&(t.expanded=!0),t.checked||(t.checked=!1),t.children&&t.children.length&&a.getAuth(t.children,!1)}),t},save:function(){var t,e=this,a=this,i=a.$refs.trees.getCheckedNodes("checked")||[],s=a.$refs.trees.getCheckedNodes("indeterminated")||[],o=(t=[]).concat.apply(t,f()(i).concat(f()(s))).map(function(t){return t.id});a.loading=!0,a.$api(a.$cfg.API.system.role.setRolePermis,{roleId:a.roleId,permisIds:o.join(",")}).then(function(t){a.loading=!1,e.$Message.success("权限设置成功"),a.close()}).catch(function(){a.loading=!1,a._showErrMsg(err,"权限设置失败")})}}},g=(a(414),Object(l.a)(p,h,[],!1,null,null,null));g.options.__file="src/components/manage/system/role/auth-tree.vue";var v=g.exports,_={mixins:[o.a],components:{BreadCrumb:s.a,DialogForm:u,AuthForm:v},data:function(){return{pageTitle:"角色管理",crumbData:["系统设置","角色管理"],TABLE_CONFIG:{field:{id:"id"},api:{query:this.$cfg.API.system.role.query,delete:this.$cfg.API.system.role.del}},columns:[{title:"序号",type:"index",width:50,align:"center"},{title:"角色名称",key:"name",align:"center"},{title:"创建时间",key:"createdTime",align:"center"},{title:"创建人",key:"creator",align:"center"},{title:"操作",align:"center",width:250,slot:"handle"}]}},methods:{showAdd:function(){this.$refs.dialogform.show()},showEdit:function(t,e){this.$refs.dialogform.show(t,e)},showDetail:function(t,e,a){this.$refs.dialogform.show(t,e,a)},showAuth:function(t){this.$refs.authform.show(t)}}},D=Object(l.a)(_,i,[],!1,null,null,null);D.options.__file="src/components/manage/system/role/index.vue";e.default=D.exports}}]);