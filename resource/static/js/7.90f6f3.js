(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{366:function(t,e,a){},367:function(t,e,a){"use strict";var i=a(366);a.n(i).a},368:function(t,e,a){"use strict";var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{staticClass:"ui-bread-crumb"},[i("Breadcrumb",a._l(a.data,function(t,e){return i("BreadcrumbItem",{key:e},[a._v(a._s(t))])}),1)],1)};i._withStripped=!0;var s={props:{data:{type:Array,default:function(){return[]}}}},o=(a(367),a(47)),n=Object(o.a)(s,i,[],!1,null,null,null);n.options.__file="src/components/manage/common/bread-crumb.vue";e.a=n.exports},369:function(t,e,a){"use strict";var i=a(18),n=a.n(i),s=a(108),o=a.n(s);e.a={data:function(){return{TABLE_CONFIG:{field:{id:"id"},api:{query:"",delete:""}},filter:{pageNum:1,pageSize:15,sort:""},autoLoad:!0,loading:!0,listData:[],totalCount:0,pickedId:[],usePage:!0,useRouterQuery:!1}},beforeRouteUpdate:function(t,e,a){if(this.useRouterQuery){var i=t.query.page||1;this.filter.pageNum=parseInt(i),this.fetchData(),a()}else a()},methods:{fetchData:function(t,e){var a=this;this.TABLE_CONFIG.api.query&&(!t&&this.loading||(this.beforeFetch&&this.beforeFetch(),e=n()({},this.filter,e),this.loading=!0,this.$api(this.TABLE_CONFIG.api.query,e,{showLoading:!0}).then(function(t){a.loading=!1,a.filter=e,a.parseData(t.result),a.afterFetch&&a.afterFetch()}).catch(function(t){a.loading=!1,a._showErrMsg(t)})))},parseData:function(t){this.usePage?(this.listData=t.records,this.totalCount=t.total):(this.listData=t,this.totalCount=t.length)},deleteData:function(t,e){if(this.TABLE_CONFIG.api.delete){var a=this,i=[],s="确定删除该条数据么?";if(t?i.push(t):(i=a.pickedId,s="确定删除选中的数据么?"),!i.length)return a.$Message.warning("未选择任何数据"),!1;var o=n()({},e);o[a.TABLE_CONFIG.field.id]=i.join(","),a._asyncDialog(s,o)}},_asyncDialog:function(t,e){var a=this;a.$Modal.confirm({title:"警告",content:"<p>".concat(t,"</p>"),loading:!0,onOk:function(){a.$api(a.TABLE_CONFIG.api.delete,e).then(function(t){a.$Modal.remove(),a.$Message.success("删除成功"),a.usePage?a.fetchData():a.__delListData(ids)}).catch(function(t){setTimeout(function(){a.$Modal.remove()},500),a._showErrMsg(t)})}})},__delListData:function(a){var i=this;this.listData.forEach(function(t,e){~a.indexOf(t[i.TABLE_CONFIG.field.id])&&i.listData.splice(e,1)})},selectRow:function(t){var e=this,a=[];t.forEach(function(t){a.push(t[e.TABLE_CONFIG.field.id])}),this.pickedId=a},sortData:function(t){t.order?this.filter.sort="ascending"==t.order?2:1:this.filter.sort="",this.fetchData()},pageChange:function(t){if(this.beforePageChange&&this.beforePageChange(t),this.useRouterQuery){var e=this.$route;if((e.query.page||1)==this.filter.pageNum)return;var a={name:e.name,meta:n()({},e.meta),params:n()({},e.params),query:n()({},e.query)};a.query.page=t,e.name||(a.path=e.path),this.$router.push(a)}else this.fetchData();this.afterPageChange&&this.afterPageChange(t)},pushData:function(t){this.listData.unshift(t),this.listData.splice(this.filter.pageSize),this.totalCount++},updateData:function(i){var s=this,o=-1;this.listData.forEach(function(t,e){var a=t[s.TABLE_CONFIG.field.id];a&&a==i[s.TABLE_CONFIG.field.id]&&(o=e)}),-1!=o&&this.$set(this.listData,o,i)}},created:function(){this.fetchDataHandle=o()(this.fetchData,200);var t=this.$route.query.page;t&&(this.filter.pageNum=parseInt(t)),this.autoLoad&&this.fetchData(!0)}}},370:function(t,e,a){"use strict";var i=a(18),s=a.n(i);e.a={data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{info:"",add:"",edit:""}},id:0,inited:!1,formData:{},rules:{},dialogShow:!1,loading:!1,hasEdited:!1,saving:!1,labelWidth:"7em",unEdit:!1}},computed:{title:function(){return this.id?"编辑":"添加"}},watch:{formData:{handler:function(){this.inited&&(this.hasEdited=!0)},deep:!0}},methods:{show:function(t,e,a){this.id=t||0,this.unEdit=a||!1,this.dialogShow=!0,e?this.setFormData(e):this.id?this.fetchData():this.setFormData(this._defaultFormData)},close:function(t){this.hasEdited,this.closeHandle(),"function"==typeof t&&t()},closeHandle:function(){this.dialogShow=!1,this.resetTimer=setTimeout(this.reset,300)},fetchData:function(){var e=this;if(this.FORM_CONFIG.api.info&&!this.loading){var t={};t[this.FORM_CONFIG.field.id]=this.id,this.loading=!0,this.$api(this.FORM_CONFIG.api.info,t).then(function(t){e.setFormData(t.result),e.loading=!1}).catch(function(t){e.loading=!1,e._showErrMsg(t)})}},setFormData:function(t){var e=this;this.formData=s()(!0,{},t),this.$refs.form.resetFields(),this.onSetFormData&&this.onSetFormData(),this.$nextTick(function(){e.inited=!0})},save:function(){var e=this;this.saving||this.$refs.form.validate(function(t){t&&e.post()})},post:function(){var e=this,a=this.id?"edit":"add",t=this.FORM_CONFIG.api[a];if(t&&(!this.beforeSave||!1!==this.beforeSave())){this.saving=!0;var i=this.parsePostData?this.parsePostData():this.formData;this.$api(t,i).then(function(t){e.$emit(a,t.result),e.saving=!1,e.hasEdited=!1,e.$Message.success("保存成功"),e.close(),e.onSuccess&&e.onSuccess(t)}).catch(function(t){e._showErrMsg(t),e.saving=!1,e.onFail&&e.onFail(t)})}},reset:function(){clearTimeout(this.resetTimer),this.inited=!1,this.hasEdited=!1;var t=this.$refs.form;t&&t.resetFields()}},created:function(){this._defaultFormData=s()(!0,{},this.formData)}}},384:function(t,e,a){},385:function(t,e,a){},412:function(t,e,a){"use strict";var i=a(384);a.n(i).a},413:function(t,e,a){"use strict";var i=a(385);a.n(i).a},432:function(t,e,a){"use strict";a.r(e);var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{directives:[{name:"title",rawName:"v-title",value:a.pageTitle,expression:"pageTitle"}],staticClass:"c-m-system-user ui-box"},[i("bread-crumb",{attrs:{data:a.crumbData}}),a._v(" "),i("search",{staticClass:"ui-search",attrs:{data:a.filter},on:{search:a.fetchData}}),a._v(" "),i("div",{staticClass:"ui-hander"},[a._auth("system-setting-user-add")?i("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:a.showAdd}},[a._v("新增")]):a._e()],1),a._v(" "),i("div",{staticClass:"ui-table-content"},[i("Table",{attrs:{border:"",columns:a.columns,data:a.listData},on:{"on-selection-change":a.selectRow},scopedSlots:a._u([{key:"handle",fn:function(t){var e=t.row;t.column,t.index;return[a._auth("system-setting-user-detail")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showDetail(e.userInfoId,e,!0)}}},[a._v("详情")]):a._e(),a._v(" "),a._auth("system-setting-user-edit")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showEdit(e.userInfoId,e)}}},[a._v("编辑")]):a._e(),a._v(" "),a._auth("system-setting-user-del")?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return a.deleteData(e.userInfoId)}}},[a._v("删除")]):a._e(),a._v(" "),a._auth("system-setting-user-resetPwd")?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return a.resetPwd(e.userInfoId,e)}}},[a._v("密码重置")]):a._e()]}}])})],1),a._v(" "),i("div",{staticClass:"ui-page"},[i("Page",{attrs:{placement:"top",total:a.totalCount,current:a.filter.pageNum,"page-size":a.filter.pageSize,"show-elevator":"","show-total":""},on:{"on-change":a.pageChange,"update:current":function(t){return a.$set(a.filter,"pageNum",t)}}})],1),a._v(" "),i("dialog-form",{ref:"form",on:{edit:a.fetchData,add:a.add}})],1)};i._withStripped=!0;var s=a(368),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-user-search search-bar"},[a("Form",{attrs:{model:e.data,inline:"","label-width":90}},[a("FormItem",{attrs:{prop:"userName",label:"用户名"}},[a("Input",{attrs:{placeholder:"用户名"},model:{value:e.data.userName,callback:function(t){e.$set(e.data,"userName",t)},expression:"data.userName"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"name",label:"姓名"}},[a("Input",{attrs:{placeholder:"姓名"},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"phone",label:"手机号"}},[a("Input",{attrs:{placeholder:"手机号"},model:{value:e.data.phone,callback:function(t){e.$set(e.data,"phone",t)},expression:"data.phone"}})],1),e._v(" "),a("FormItem",{attrs:{prop:"organizationInfoIdRefName",label:"机构名"}},[a("Input",{attrs:{placeholder:"机构"},model:{value:e.data.organizationInfoIdRefName,callback:function(t){e.$set(e.data,"organizationInfoIdRefName",t)},expression:"data.organizationInfoIdRefName"}})],1),e._v(" "),a("br"),e._v(" "),a("FormItem",[a("Button",{attrs:{icon:"ios-search"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{attrs:{icon:"md-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1)};o._withStripped=!0;var n={props:{data:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{search:function(){this.$emit("search")},reset:function(){var t=this;t.data.userName="",t.data.name="",t.data.phone="",t.data.organizationInfoIdRefName="",t.search()}}},r=a(47),l=Object(r.a)(n,o,[],!1,null,null,null);l.options.__file="src/components/manage/system/user/search.vue";var c=l.exports,u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-system-user-dialog"},[a("Modal",{staticClass:"ui-form system-user-form ",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.close},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("Form",{ref:"form",staticClass:"ui-tabel-body c",attrs:{rules:e.rules,model:e.formData,"label-width":90}},[a("FormItem",{attrs:{label:"用户名",prop:"userName"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"用户名"},model:{value:e.formData.userName,callback:function(t){e.$set(e.formData,"userName",t)},expression:"formData.userName"}})],1),e._v(" "),a("FormItem",{attrs:{label:"姓名",prop:"name"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"姓名"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"手机号",prop:"phone"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"手机号"},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone",t)},expression:"formData.phone"}})],1),e._v(" "),a("FormItem",{attrs:{label:"角色选择",prop:"roleIds"}},[a("Select",{attrs:{disabled:e.unEdit||e.isSelf,multiple:""},model:{value:e.formData.roleIds,callback:function(t){e.$set(e.formData,"roleIds",t)},expression:"formData.roleIds"}},e._l(e.roleOption,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),a("FormItem",{staticClass:"choose-organ",attrs:{label:"所属机构",prop:"organizationInfoIdRefName"}},[a("Input",{attrs:{disabled:e.unEdit,readonly:!0,placeholder:"所属机构"},model:{value:e.formData.organizationInfoIdRefName,callback:function(t){e.$set(e.formData,"organizationInfoIdRefName",t)},expression:"formData.organizationInfoIdRefName"}}),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.unEdit},on:{click:e.showChooseOrgan}},[e._v("机构选择")])],1),e._v(" "),a("FormItem",{attrs:{label:"备注",prop:"remark"}},[a("Input",{attrs:{rows:4,disabled:e.unEdit,type:"textarea",placeholder:"备注"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.loading||e.saving||e.unEdit,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1)],1),e._v(" "),a("choose-organ",{ref:"organChoose",on:{choose:e.choose}})],1)};u._withStripped=!0;var d=a(370),h=a(18),f=a.n(h),m=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("Modal",{staticClass:"ui-form c-m-user-choose-organ",attrs:{"mask-closable":!1,title:a.title,width:"1200"},on:{"on-cancel":a.close},model:{value:a.dialogShow,callback:function(t){a.dialogShow=t},expression:"dialogShow"}},[i("div",{staticClass:"ui-choose-organ-left c"},[i("div",{staticClass:"tree-title"},[a._v("机构信息")]),a._v(" "),i("div",{staticClass:"choose-organ-tree"},[i("Tree",{ref:"tree",attrs:{data:a.treeData},on:{"on-select-change":a.selectChange}})],1)]),a._v(" "),i("div",{staticClass:"c-m-choose-organ-search ui-search search-bar"},[i("Form",{attrs:{model:a.filter,inline:"","label-width":120}},[i("FormItem",{attrs:{prop:"name",label:"机构名"}},[i("Input",{attrs:{placeholder:"机构名"},model:{value:a.filter.name,callback:function(t){a.$set(a.filter,"name",t)},expression:"filter.name"}})],1),a._v(" "),i("FormItem",{attrs:{"label-width":0}},[i("Button",{attrs:{icon:"ios-search"},on:{click:a.fetchData}},[a._v("搜索")]),a._v(" "),i("Button",{attrs:{icon:"md-refresh"},on:{click:a.reset}},[a._v("重置")])],1)],1)],1),a._v(" "),i("div",{staticClass:"ui-choose-organ-right c"},[i("div",{staticClass:"ui-table-content"},[i("Table",{attrs:{border:"",columns:a.columns,data:a.listData},scopedSlots:a._u([{key:"handle",fn:function(t){var e=t.row;t.column,t.index;return[i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.chooseOrgan(e)}}},[a._v("选择")])]}}])})],1),a._v(" "),i("div",{staticClass:"ui-page"},[i("Page",{attrs:{placement:"top",total:a.totalCount,current:a.filter.pageNum,"page-size":a.filter.pageSize,"show-elevator":"","show-total":""},on:{"on-change":a.pageChange,"update:current":function(t){return a.$set(a.filter,"pageNum",t)}}})],1)]),a._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:a.close}},[a._v("关闭")])],1)])};m._withStripped=!0;var p=a(369),g={mixins:[p.a],data:function(){return{title:"机构选择",dialogShow:!1,treeData:[],filter:{parentId:0,name:""},TABLE_CONFIG:{field:{id:"id"},api:{query:this.$cfg.API.system.organization.query}},autoLoad:!1,columns:[{title:"序号",type:"index",width:50,align:"center"},{title:"机构名称",key:"name",align:"center"},{title:"操作",align:"center",width:200,slot:"handle"}]}},methods:{show:function(){this.fetchTreeData()},close:function(){var t=this;t.dialogShow=!1,setTimeout(function(){t.resetDialogData()},500)},fetchTreeData:function(){var a=this,i=this;i.$api(i.$cfg.API.system.organization.treeList,null,{showLoading:!0}).then(function(t){a.dialogShow=!0;var e=t.result.trees[0]||[];e.expand=!0,e.selected=!0,i.treeData=t.result.trees||[],i.filter.parentId=e.id,i.fetchData(!0,{pageNum:1})}).catch(function(){})},selectChange:function(t,e){this.filter.parentId=e.id,this.fetchData()},chooseOrgan:function(t){this.$emit("choose",t),this.close()},reset:function(){this.filter.name="",this.fetchData()},resetDialogData:function(){this.treeData=[],this.listData=[],this.filter.name=""}}},v=(a(412),Object(r.a)(g,m,[],!1,null,null,null));v.options.__file="src/components/manage/system/user/choose-organ.vue";var _=v.exports,I={mixins:[d.a],components:{chooseOrgan:_},data:function(){return{FORM_CONFIG:{field:{id:"userInfoId"},api:{add:this.$cfg.API.system.user.add,edit:this.$cfg.API.system.user.edit}},formData:{userName:"",name:"",phone:"",roleIds:"",organizationInfoIdRef:"",organizationInfoIdRefName:"",remark:""},userName:"",isShowPassword:!1,rules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:this.checkUsername,trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:this.checkPhone,trigger:"blur"}],roleIds:[{type:"array",required:!0,message:"请选择角色",trigger:"change"}],organizationInfoIdRefName:[{required:!0,message:"请选择机构",trigger:"blur"}]},roleOption:[]}},computed:{isSelf:function(){return this.userName==this.$store.state.info.common.userName}},methods:{checkUsername:function(t,e,a){if(!this.$cfg.REG.letterOrNumber.test(e))return a(new Error("请输入英文，字母或其组合"));a()},checkPhone:function(t,e,a){if(!this.$cfg.REG.phone.test(e))return a(new Error("请输入正确的手机号"));a()},showPwd:function(){this.isShowPassword=!this.isShowPassword},fetchRoleOption:function(){var e=this;this.$api(this.$cfg.API.system.role.query,{pageSize:100}).then(function(t){e.roleOption=t.result.records}).catch(function(){})},onSetFormData:function(){this.userName=this.formData.userName,this.formData.roleIds=this.formData.roleIds?this.formData.roleIds.split(","):[]},parsePostData:function(){var t=f()(!0,{},this.formData);return t.roleIds=t.roleIds.join(","),t},showChooseOrgan:function(){this.$refs.organChoose.show()},choose:function(t){this.formData.organizationInfoIdRef=t.id,this.formData.organizationInfoIdRefName=t.name}},created:function(){this.fetchRoleOption()}},D=(a(413),Object(r.a)(I,u,[],!1,null,null,null));D.options.__file="src/components/manage/system/user/form.vue";var b=D.exports,w={mixins:[p.a],components:{BreadCrumb:s.a,Search:c,DialogForm:b},data:function(){return{pageTitle:"用户管理",crumbData:["系统设置","用户管理"],filter:{userName:"",name:"",phone:"",organizationInfoIdRef:""},TABLE_CONFIG:{field:{id:"userInfoId"},api:{query:this.$cfg.API.system.user.query,delete:this.$cfg.API.system.user.del}},columns:[{title:"序号",type:"index",width:50,align:"center"},{title:"用户名",key:"userName",align:"center"},{title:"姓名",key:"name",align:"center"},{title:"手机",key:"phone",align:"center"},{title:"机构名",key:"organizationInfoIdRefName",align:"center"},{title:"创建时间",key:"createdTime",align:"center"},{title:"操作",align:"center",width:260,slot:"handle"}]}},methods:{showAdd:function(){this.$refs.form.show()},showEdit:function(t,e){this.$refs.form.show(t,e)},showDetail:function(t,e,a){this.$refs.form.show(t,e,a)},resetPwd:function(t,a){var i=this;i.$Modal.confirm({title:"警告",content:"<p>确定重置密码吗?</p>",loading:!0,onOk:function(){i.$api(i.$cfg.API.system.user.resetPwd,{id:t}).then(function(t){var e=a.phone?a.phone.substr(a.phone.length-6):"";i.$Modal.remove(),i.$Message.success("密码重置为手机号后六位 ".concat(e))}).catch(function(t){i._showErrMsg(t,"密码重置失败"),setTimeout(function(){i.$Modal.remove()},500)})}})},add:function(t){var e=t.pwd;this.pwdTip(e),this.fetchData()},pwdTip:function(t){this.$Modal.success({title:"提示",content:"<p>密码为手机号后六位 ".concat(t,"</p>")})}}},y=Object(r.a)(w,i,[],!1,null,null,null);y.options.__file="src/components/manage/system/user/index.vue";e.default=y.exports}}]);