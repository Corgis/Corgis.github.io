(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{366:function(t,e,a){},367:function(t,e,a){"use strict";var i=a(366);a.n(i).a},368:function(t,e,a){"use strict";var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{staticClass:"ui-bread-crumb"},[i("Breadcrumb",a._l(a.data,function(t,e){return i("BreadcrumbItem",{key:e},[a._v(a._s(t))])}),1)],1)};i._withStripped=!0;var s={props:{data:{type:Array,default:function(){return[]}}}},r=(a(367),a(47)),n=Object(r.a)(s,i,[],!1,null,null,null);n.options.__file="src/components/manage/common/bread-crumb.vue";e.a=n.exports},369:function(t,e,a){"use strict";var i=a(18),n=a.n(i),s=a(108),r=a.n(s);e.a={data:function(){return{TABLE_CONFIG:{field:{id:"id"},api:{query:"",delete:""}},filter:{pageNum:1,pageSize:15,sort:""},autoLoad:!0,loading:!0,listData:[],totalCount:0,pickedId:[],usePage:!0,useRouterQuery:!1}},beforeRouteUpdate:function(t,e,a){if(this.useRouterQuery){var i=t.query.page||1;this.filter.pageNum=parseInt(i),this.fetchData(),a()}else a()},methods:{fetchData:function(t,e){var a=this;this.TABLE_CONFIG.api.query&&(!t&&this.loading||(this.beforeFetch&&this.beforeFetch(),e=n()({},this.filter,e),this.loading=!0,this.$api(this.TABLE_CONFIG.api.query,e,{showLoading:!0}).then(function(t){a.loading=!1,a.filter=e,a.parseData(t.result),a.afterFetch&&a.afterFetch()}).catch(function(t){a.loading=!1,a._showErrMsg(t)})))},parseData:function(t){this.usePage?(this.listData=t.records,this.totalCount=t.total):(this.listData=t,this.totalCount=t.length)},deleteData:function(t,e){if(this.TABLE_CONFIG.api.delete){var a=this,i=[],s="确定删除该条数据么?";if(t?i.push(t):(i=a.pickedId,s="确定删除选中的数据么?"),!i.length)return a.$Message.warning("未选择任何数据"),!1;var r=n()({},e);r[a.TABLE_CONFIG.field.id]=i.join(","),a._asyncDialog(s,r)}},_asyncDialog:function(t,e){var a=this;a.$Modal.confirm({title:"警告",content:"<p>".concat(t,"</p>"),loading:!0,onOk:function(){a.$api(a.TABLE_CONFIG.api.delete,e).then(function(t){a.$Modal.remove(),a.$Message.success("删除成功"),a.usePage?a.fetchData():a.__delListData(ids)}).catch(function(t){setTimeout(function(){a.$Modal.remove()},500),a._showErrMsg(t)})}})},__delListData:function(a){var i=this;this.listData.forEach(function(t,e){~a.indexOf(t[i.TABLE_CONFIG.field.id])&&i.listData.splice(e,1)})},selectRow:function(t){var e=this,a=[];t.forEach(function(t){a.push(t[e.TABLE_CONFIG.field.id])}),this.pickedId=a},sortData:function(t){t.order?this.filter.sort="ascending"==t.order?2:1:this.filter.sort="",this.fetchData()},pageChange:function(t){if(this.beforePageChange&&this.beforePageChange(t),this.useRouterQuery){var e=this.$route;if((e.query.page||1)==this.filter.pageNum)return;var a={name:e.name,meta:n()({},e.meta),params:n()({},e.params),query:n()({},e.query)};a.query.page=t,e.name||(a.path=e.path),this.$router.push(a)}else this.fetchData();this.afterPageChange&&this.afterPageChange(t)},pushData:function(t){this.listData.unshift(t),this.listData.splice(this.filter.pageSize),this.totalCount++},updateData:function(i){var s=this,r=-1;this.listData.forEach(function(t,e){var a=t[s.TABLE_CONFIG.field.id];a&&a==i[s.TABLE_CONFIG.field.id]&&(r=e)}),-1!=r&&this.$set(this.listData,r,i)}},created:function(){this.fetchDataHandle=r()(this.fetchData,200);var t=this.$route.query.page;t&&(this.filter.pageNum=parseInt(t)),this.autoLoad&&this.fetchData(!0)}}},370:function(t,e,a){"use strict";var i=a(18),s=a.n(i);e.a={data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{info:"",add:"",edit:""}},id:0,inited:!1,formData:{},rules:{},dialogShow:!1,loading:!1,hasEdited:!1,saving:!1,labelWidth:"7em",unEdit:!1}},computed:{title:function(){return this.id?"编辑":"添加"}},watch:{formData:{handler:function(){this.inited&&(this.hasEdited=!0)},deep:!0}},methods:{show:function(t,e,a){this.id=t||0,this.unEdit=a||!1,this.dialogShow=!0,e?this.setFormData(e):this.id?this.fetchData():this.setFormData(this._defaultFormData)},close:function(t){this.hasEdited,this.closeHandle(),"function"==typeof t&&t()},closeHandle:function(){this.dialogShow=!1,this.resetTimer=setTimeout(this.reset,300)},fetchData:function(){var e=this;if(this.FORM_CONFIG.api.info&&!this.loading){var t={};t[this.FORM_CONFIG.field.id]=this.id,this.loading=!0,this.$api(this.FORM_CONFIG.api.info,t).then(function(t){e.setFormData(t.result),e.loading=!1}).catch(function(t){e.loading=!1,e._showErrMsg(t)})}},setFormData:function(t){var e=this;this.formData=s()(!0,{},t),this.$refs.form.resetFields(),this.onSetFormData&&this.onSetFormData(),this.$nextTick(function(){e.inited=!0})},save:function(){var e=this;this.saving||this.$refs.form.validate(function(t){t&&e.post()})},post:function(){var e=this,a=this.id?"edit":"add",t=this.FORM_CONFIG.api[a];if(t&&(!this.beforeSave||!1!==this.beforeSave())){this.saving=!0;var i=this.parsePostData?this.parsePostData():this.formData;this.$api(t,i).then(function(t){e.$emit(a,t.result),e.saving=!1,e.hasEdited=!1,e.$Message.success("保存成功"),e.close(),e.onSuccess&&e.onSuccess(t)}).catch(function(t){e._showErrMsg(t),e.saving=!1,e.onFail&&e.onFail(t)})}},reset:function(){clearTimeout(this.resetTimer),this.inited=!1,this.hasEdited=!1;var t=this.$refs.form;t&&t.resetFields()}},created:function(){this._defaultFormData=s()(!0,{},this.formData)}}},387:function(t,e,a){},388:function(t,e,a){},389:function(t,e,a){},415:function(t,e,a){"use strict";var i=a(387);a.n(i).a},416:function(t,e,a){"use strict";var i=a(388);a.n(i).a},417:function(t,e,a){"use strict";var i=a(389);a.n(i).a},430:function(t,e,a){"use strict";a.r(e);var i=function(){var a=this,t=a.$createElement,i=a._self._c||t;return i("div",{directives:[{name:"title",rawName:"v-title",value:a.pageTitle,expression:"pageTitle"}],staticClass:"c-m-system-organization"},[i("bread-crumb",{attrs:{data:a.crumbData}}),a._v(" "),i("div",{staticClass:"ui-organ-box c"},[i("div",{staticClass:"organ-left-content c"},[i("div",{staticClass:"tree-title"},[a._v("机构信息")]),a._v(" "),a._auth("system-setting-organ-editName")?i("edit-name-pop",{directives:[{name:"show",rawName:"v-show",value:a.showEidtBtn,expression:"showEidtBtn"}],ref:"editname",on:{setrootname:a.setRootName}}):a._e(),a._v(" "),i("organ-tree",{ref:"organtree",on:{change:a.changeSelect,"set-selected-node":a.setNode}})],1),a._v(" "),i("div",{staticClass:"organ-right-content"},[i("search",{staticClass:"ui-search",attrs:{data:a.filter},on:{search:a.fetchData}}),a._v(" "),i("div",{staticClass:"ui-hander"},[a._auth("system-setting-organ-add")?i("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:a.showAdd}},[a._v("新增")]):a._e()],1),a._v(" "),i("div",{staticClass:"ui-table-content"},[i("Table",{attrs:{border:"",columns:a.columns,data:a.listData},scopedSlots:a._u([{key:"handle",fn:function(t){var e=t.row;t.column,t.index;return[a._auth("system-setting-organ-detail")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showDetail(e.id,e,!0)}}},[a._v("详情")]):a._e(),a._v(" "),a._auth("system-setting-organ-edit")?i("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return a.showEdit(e.id,e)}}},[a._v("编辑")]):a._e(),a._v(" "),a._auth("system-setting-organ-del")?i("Button",{attrs:{type:"error",size:"small"},on:{click:function(t){return a.deleteData(e.id)}}},[a._v("删除")]):a._e()]}}])})],1),a._v(" "),i("div",{staticClass:"ui-page"},[i("Page",{attrs:{placement:"top",current:a.filter.pageNum,total:a.totalCount,"page-size":a.filter.pageSize,"show-elevator":"","show-total":""},on:{"on-change":a.pageChange,"update:current":function(t){return a.$set(a.filter,"pageNum",t)}}})],1)],1)]),a._v(" "),i("dialog-form",{ref:"dialogform",attrs:{partername:a.parterName,parterid:a.filter.parentId},on:{edit:a.fetchData,add:a.fetchData}})],1)};i._withStripped=!0;var s=a(368),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-organization-search search-bar"},[a("Form",{attrs:{model:e.data,inline:"","label-width":120}},[a("FormItem",{attrs:{prop:"name",label:"机构名"}},[a("Input",{attrs:{placeholder:"机构名"},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}})],1),e._v(" "),a("FormItem",{attrs:{"label-width":0}},[a("Button",{attrs:{icon:"ios-search"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{attrs:{icon:"md-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1)};r._withStripped=!0;var n={props:{data:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{search:function(){this.$emit("search")},reset:function(){this.data.name="",this.data.institutionNumber="",this.search()}}},o=a(47),c=Object(o.a)(n,r,[],!1,null,null,null);c.options.__file="src/components/manage/system/organization/search.vue";var l=c.exports,u=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ui-tree-picker"},[e("Tree",{ref:"tree",attrs:{data:this.treeData},on:{"on-select-change":this.selectChange}})],1)};u._withStripped=!0;var d={data:function(){return{treeData:[]}},methods:{fetchTreeData:function(){var a=this;a.$api(a.$cfg.API.system.organization.treeList,null,{showLoading:!0}).then(function(t){var e=t.result.trees[0]||[];e.expand=!0,e.selected=!0,a.$emit("set-selected-node",e),a.treeData=t.result.trees||[]}).catch(function(){})},selectChange:function(t,e){this.$emit("change",e),e.selected=!0},setNodeName:function(t){this.treeData[0].title=t}},created:function(){this.fetchTreeData()}},h=(a(415),Object(o.a)(d,u,[],!1,null,null,null));h.options.__file="src/components/manage/common/tree-picker.vue";var f=h.exports,m=a(369),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-m-system-organization-dialog"},[a("Modal",{staticClass:"ui-form",attrs:{"mask-closable":!1,title:e.title,width:"500"},on:{"on-cancel":e.close},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("Form",{ref:"form",staticClass:"ui-tabel-body c",attrs:{rules:e.rules,model:e.formData,"label-width":90}},[a("FormItem",{attrs:{label:"上级机构",prop:"pName"}},[e._v("\n\t\t\t\t"+e._s(e.formData.pName)+"\n\t\t\t")]),e._v(" "),a("FormItem",{attrs:{label:"机构名称",prop:"name"}},[a("Input",{attrs:{disabled:e.unEdit,placeholder:"机构名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"城市",prop:"city"}},[a("Select",{attrs:{placeholder:"城市"},model:{value:e.formData.city,callback:function(t){e.$set(e.formData,"city",t)},expression:"formData.city"}},e._l(e.areaOption,function(t){return a("Option",{key:t.regionCode,attrs:{value:t.regionCode}},[e._v(e._s(t.region))])}),1)],1),e._v(" "),a("FormItem",{attrs:{label:"备注",prop:"remark"}},[a("Input",{attrs:{disabled:e.unEdit,type:"textarea",placeholder:"备注"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",disabled:e.loading||e.saving||e.unEdit,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1)],1)],1)};p._withStripped=!0;var g={mixins:[a(370).a],data:function(){return{FORM_CONFIG:{field:{id:"id"},api:{add:this.$cfg.API.system.organization.add,edit:this.$cfg.API.system.organization.edit}},areaOption:[],formData:{parentId:"",name:"",institutionNumber:"",city:"",remark:""},rules:{pName:[{required:!0,message:"请输入上级机构",trigger:"blur"}],name:[{required:!0,message:"请输入机构名称",trigger:"blur"}],city:[{required:!0,message:"请输入城市",trigger:"blur"}]}}},methods:{fetchAreaOption:function(){var e=this;this.$api(this.$cfg.API.system.organization.areaList,{pageSize:1e3,pageNum:1}).then(function(t){e.areaOption=t.result.records||[]}).catch(function(){})}},created:function(){this.fetchAreaOption()}},v=Object(o.a)(g,p,[],!1,null,null,null);v.options.__file="src/components/manage/system/organization/form.vue";var _=v.exports,D=a(18),b=a.n(D),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ui-edit-rootname-pop"},[a("Poptip",{model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("Form",{ref:"form",staticClass:"ui-tabel-body c",attrs:{rules:e.rules,model:e.formData}},[a("FormItem",{attrs:{prop:"rootName","label-width":0}},[a("Input",{attrs:{placeholder:"修改根节点名称"},model:{value:e.formData.rootName,callback:function(t){e.$set(e.formData,"rootName",t)},expression:"formData.rootName"}})],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"5px"}},[a("Button",{attrs:{type:"text",size:"small"},on:{click:e.close}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.setRootName}},[e._v("保存")])],1)],1),e._v(" "),a("Button",{attrs:{type:"primary",size:"small"}},[e._v("修改名称")])],1)],1)};y._withStripped=!0;var N={data:function(){return{visible:!1,formData:{rootName:""},rules:{rootName:[{required:!0,message:"名称不能为空",trigger:"blur"}]}}},methods:{close:function(){this.visible=!1,this.resetForm()},resetForm:function(){this.$refs.form.resetFields()},setRootName:function(){var e=this;this.$refs.form.validate(function(t){t&&e.$emit("setrootname",e.formData.rootName)})}}},w=(a(416),Object(o.a)(N,y,[],!1,null,null,null));w.options.__file="src/components/manage/system/organization/eidt-pop.vue";var F=w.exports,$={mixins:[m.a],components:{BreadCrumb:s.a,Search:l,OrganTree:f,DialogForm:_,editNamePop:F},data:function(){return{pageTitle:"机构管理",crumbData:["系统设置","机构管理"],filter:{parentId:0,institutionNumber:"",name:"",pageNum:1,pageSize:15},autoLoad:!1,parterName:"",showEidtBtn:!1,rootId:0,TABLE_CONFIG:{field:{id:"id"},api:{query:this.$cfg.API.system.organization.query,delete:this.$cfg.API.system.organization.del}},columns:[{title:"序号",type:"index",width:50,align:"center"},{title:"机构名称",key:"name",align:"center"},{title:"城市",key:"cityName",align:"center"},{title:"操作",align:"center",width:200,slot:"handle"}]}},methods:{changeSelect:function(t){var e=this;e.rootId==t.id?e.showEidtBtn=!0:e.showEidtBtn=!1,e.filter.parentId=t.id,e.parterName=t.title,e.fetchData(!0,{pageNum:1})},setNode:function(t){this.filter.parentId=t.id,this.rootId=t.id,this.parterName=t.title,this.showEidtBtn=!0,this.fetchData(!0)},showAdd:function(){this.$refs.dialogform.show(null,{pName:this.parterName,parentId:this.filter.parentId})},showEdit:function(t,e){var a=b()(!0,{},e,{pName:this.parterName});this.$refs.dialogform.show(t,a)},showDetail:function(t,e,a){var i=b()(!0,{},e,{pName:this.parterName});this.$refs.dialogform.show(t,i,a)},setRootName:function(e){var a=this;this.$api(this.$cfg.API.system.organization.editName,{id:this.filter.parentId,name:e}).then(function(t){a.$Message.success("修改成功"),a.$refs.editname.close(),a.parterName=e,a.$refs.organtree.setNodeName(e)}).catch(function(t){a._showErrMsg(t,"修改失败")})}}},I=(a(417),Object(o.a)($,i,[],!1,null,null,null));I.options.__file="src/components/manage/system/organization/index.vue";e.default=I.exports}}]);